<!DOCTYPE html>
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<title>demographics survey</title>
<script src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js' type='text/javascript'></script>
<script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js' type='text/javascript'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.js' type='text/javascript'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/chosen/1.7.0/chosen.jquery.min.js' type='text/javascript'></script>
<link rel='stylesheet' type='text/css' href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.css'>
<link rel='stylesheet' type='text/css' href='https://cdnjs.cloudflare.com/ajax/libs/chosen/1.7.0/chosen.min.css'>
</head>
<body>
    <div class='container'>
        <div class='row'>
            <div class='col-md-3 col-sm-6 center-block' style='float: none !important'>
                <div class='alert alert-success' role='alert' id='survey-notification'>
                    This HIT can be completed once a month.</div>
                <form name='mturk_form' method='post' id='mturk_form' style='display:none'
                    action='${endpoint}/mturk/externalSubmit'>
                    <input type='hidden' value='' name='assignmentId' id='assignmentId' />
                    <div class='form-group'>
                        <label>1. What is your gender?</label>
                        <div class='radio'>
                          <label>
                            <input type='radio' name='gender' value='male'>
                            Male
                          </label>
                        </div>
                        <div class='radio'>
                          <label>
                            <input type='radio' name='gender' value='female'>
                            Female
                          </label>
                        </div>
                    </div>
                    <div class='form-group'>
                        <label for='yearOfBirth'>2. What is your year of birth?</label>
                        <select class='form-control' id='yearOfBirth' name='yearOfBirth'>
                            <option value=''></option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='maritalStatus'>3. Your marital status?</label>
                        <select class='form-control' id='maritalStatus' name='maritalStatus'>
                            <option value=''></option>
                            <option value='cohabitating'>cohabitating</option>
                            <option value='divorced'>divorced</option>
                            <option value='engaged'>engaged</option>
                            <option value='married'>married</option>
                            <option value='single'>single</option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='householdSize'>4. Household size?</label>
                        <select class='form-control' id='householdSize' name='householdSize'>
                            <option value=''></option>
                            <option value='1'>1</option>
                            <option value='2'>2</option>
                            <option value='3'>3</option>
                            <option value='4'>4</option>
                            <option value='5+'>5+</option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='householdIncome'>5. Household income?</label>
                        <select class='form-control' id='householdIncome' name='householdIncome'>
                            <option value=''></option>
                            <option value='Less than $10,000'>Less than $10,000</option>
                            <option value='$10,000-$14,999'>$10,000-$14,999</option>
                            <option value='$15,000-$24,999'>$15,000-$24,999</option>
                            <option value='$25,000-$39,999'>$25,000-$39,999</option>
                            <option value='$40,000-$59,999'>$40,000-$59,999</option>
                            <option value='$60,000-$74,999'>$60,000-$74,999</option>
                            <option value='$75,000-$99,999'>$75,000-$99,999</option>
                            <option value='$100,000 or more'>$100,000 or more</option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='educationalLevel'>6. Educational level?</label>
                        <select class='form-control' id='educationalLevel' name='educationalLevel'>
                            <option value=''></option>
                            <option value='Some High School'>Some High School</option>
                            <option value='High School Graduate'>High School Graduate</option>
                            <option value='Some college, no degree'>Some college, no degree</option>
                            <option value='Associates degree'>Associates degree</option>
                            <option value='Bachelors degree'>Bachelors degree</option>
                            <option value='Graduate degree, Masters'>Graduate degree, Masters</option>
                            <option value='Graduate degree, Doctorate'>Graduate degree, Doctorate</option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='educationalLevel'>7. Time spent on Mechanical Turk per week?</label>
                        <select class='form-control' id='timeSpentOnMturk' name='timeSpentOnMturk'>
                            <option value=''></option>
                            <option value='Less than 1 hour per week'>Less than 1 hour per week</option>
                            <option value='1-2 hours per week'>1-2 hours per week</option>
                            <option value='2-4 hours per week'>2-4 hours per week</option>
                            <option value='4-8 hours per week'>4-8 hours per week</option>
                            <option value='8-20 hours per week'>8-20 hours per week</option>
                            <option value='20-40 hours per week'>20-40 hours per week</option>
                            <option value='More than 40 hours per week'>More than 40 hours per week</option>
                        </select>
                    </div>

                    <div class='form-group'>
                        <label for='weeklyIncomeFromMturk'>8. Weekly Income from Mechanical Turk?</label>
                        <select class='form-control' id='weeklyIncomeFromMturk' name='weeklyIncomeFromMturk'>
                            <option value=''></option>
                            <option value='Less than $1 per week'>Less than $1 per week</option>
                            <option value='$1-$5 per week'>$1-$5 per week</option>
                            <option value='$5-$10 per week'>$5-$10 per week</option>
                            <option value='$10-$20 per week'>$10-$20 per week</option>
                            <option value='$20-$50 per week'>$20-$50 per week</option>
                            <option value='$50-$100 per week'>$50-$100 per week</option>
                            <option value='$100-$200 per week'>$100-$200 per week</option>
                            <option value='$200-$500 per week'>$200-$500 per week</option>
                            <option value='More than $500 per week'>More than $500 per week</option>
                        </select>
                    </div>

                    <div class='form-group'>
                        <label for='languagesSpoken'>9. Languages spoken?</label>
                        <div>
                            <select class='form-control' id='languagesSpoken' name='languagesSpoken'
                                    data-placeholder=" " multiple>
                            </select>
                        </div>
                    </div>
                    <br><div class='alert alert-danger' role='alert' style='display:none' id='validation-error'>All fields are required!</div>
                    <input type='submit' id='submitButton' class='btn btn-primary' style='margin-top: 5px;' value='Submit' />
                </form>
                <br>
                <div class='alert alert-danger' role='alert' style='display:none' id='survey-error'>
                    You already have answered this HIT <span id='answer-date'></span>.
                    <br>You can answer again on <span id='allowed-date'></span>.
                </div>
            </div>
        </div>
    </div>
    <script type='text/javascript'>
        $(document).ready(function() {
            var assignmentId = turkGetParam('assignmentId', '');
            var hitId = turkGetParam('hitId', '');
            var workerId = turkGetParam('workerId', '');
            $('#assignmentId').val(assignmentId);

            var years = '<option value=""></option>';
            for(var i=1910; i<=2010; i++) {
                years += '<option value="' + i + '">' + i + '</option>';
            }
            $('#yearOfBirth').html(years);

            var $languagesSpoken = $("#languagesSpoken");
            var languagesHtml = '<option value=""></option>';
            $.each(LANGUAGES, function (idx, obj) {
                languagesHtml += '<option value="' + obj + '">' + obj + '</option>';
            });
            $languagesSpoken.html(languagesHtml);
            $languagesSpoken.chosen({width: '100%'});

            if(workerId) {
                $.get('https://mturk-demographics.appspot.com/getAnswer?workerId=' + workerId + '&surveyId=${surveyId}',
                        function(response) {
                            if(response) {
                                $('#answer-date').text(response.date);
                                var allowedDate = new Date(response.date);
                                allowedDate.setMonth(allowedDate.getMonth() + 1);
                                allowedDate.setDate(allowedDate.getDate() + 1);
                                $('#allowed-date').text(moment(allowedDate).format('ll'));
                                $('#survey-error').show();
                            } else {
                                $('#mturk_form').show();
                            }
                }, 'jsonp');
            } else {
                $('#mturk_form').show();
            }

            if (assignmentId == 'ASSIGNMENT_ID_NOT_AVAILABLE') {
                $('#submitButton').attr('disabled', true);
                $('#submitButton').val('You must ACCEPT the HIT before you can submit the results.');
            }

            var formSubmitted = false;
            $('#mturk_form').submit(function(event) {
                if(formSubmitted == false) {
                    var params = {answers: {}};
                    params.hitId = hitId;
                    params.workerId = workerId;
                    params.surveyId='${surveyId}';
                    params.answers.gender = $('input[name="gender"]:checked', '#mturk_form').val();
                    params.answers.yearOfBirth = $('#yearOfBirth').val();
                    params.answers.maritalStatus = $('#maritalStatus').val();
                    params.answers.householdSize = $('#householdSize').val();
                    params.answers.householdIncome = $('#householdIncome').val();
                    params.answers.educationalLevel = $('#educationalLevel').val();
                    params.answers.timeSpentOnMturk = $('#timeSpentOnMturk').val();
                    params.answers.weeklyIncomeFromMturk = $('#weeklyIncomeFromMturk').val();
                    params.answers.languagesSpoken = $('#languagesSpoken').val() ? $('#languagesSpoken').val().join(',') : '';

                    if(!params.answers.gender || params.answers.yearOfBirth == '' ||
                            params.answers.yearOfBirth == '' || params.answers.maritalStatus == '' ||
                            params.answers.householdSize == '' || params.answers.householdIncome == '' ||
                            params.answers.educationalLevel == '' || params.answers.timeSpentOnMturk == '' ||
                            params.answers.weeklyIncomeFromMturk == '' || params.answers.languagesSpoken == '') {
                        $('#validation-error').show();
                        event.preventDefault();
                        return;
                    }

                    $.ajax({
                        type : 'GET',
                        url : 'https://mturk-demographics.appspot.com/saveAnswer?userAnswer='
                                + encodeURIComponent(JSON.stringify(params)),
                        dataType: 'jsonp'
                    }).done(function(data) {
                        formSubmitted = true;
                        $('#mturk_form').submit();
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        console.log('fail');
                    });
                    event.preventDefault();
                }
            });
        });

        var LANGUAGES = {
            "EN":"English",
            "ES":"Spanish",
            "ZH":"Chinese",
            "FR":"French",
            "HI":"Hindi",
            "TL":"Tagalog",
            "AR":"Arabic",
            "RU":"Russian",
            "VI":"Vietnamese",
            "AB":"Abkhazian",
            "AA":"Afar",
            "AF":"Afrikaans",
            "SQ":"Albanian",
            "AM":"Amharic",
            "HY":"Armenian",
            "AS":"Assamese",
            "AY":"Aymara",
            "AZ":"Azerbaijani",
            "BA":"Bashkir",
            "EU":"Basque",
            "BN":"Bengali",
            "DZ":"Bhutani",
            "BH":"Bihari",
            "BI":"Bislama",
            "BR":"Breton",
            "BG":"Bulgarian",
            "MY":"Burmese",
            "BE":"Byelorussian",
            "KM":"Cambodian",
            "CA":"Catalan",
            "CO":"Corsican",
            "HR":"Croatian",
            "CS":"Czech",
            "DA":"Danish",
            "NL":"Dutch",
            "EO":"Esperanto",
            "ET":"Estonian",
            "FO":"Faeroese",
            "FJ":"Fiji",
            "FI":"Finnish",
            "FY":"Frisian",
            "GD":"Gaelic",
            "GL":"Galician",
            "KA":"Georgian",
            "DE":"German",
            "EL":"Greek",
            "KL":"Greenlandic",
            "GN":"Guarani",
            "GU":"Gujarati",
            "HA":"Hausa",
            "IW":"Hebrew",
            "HU":"Hungarian",
            "IS":"Icelandic",
            "IN":"Indonesian",
            "IA":"Interlingua",
            "IE":"Interlingue",
            "IK":"Inupiak",
            "GA":"Irish",
            "IT":"Italian",
            "JA":"Japanese",
            "JW":"Javanese",
            "KN":"Kannada",
            "KS":"Kashmiri",
            "KK":"Kazakh",
            "RW":"Kinyarwanda",
            "KY":"Kirghiz",
            "RN":"Kirundi",
            "KO":"Korean",
            "KU":"Kurdish",
            "LO":"Laothian",
            "LA":"Latin",
            "LV":"Latvian",
            "LN":"Lingala",
            "LT":"Lithuanian",
            "MK":"Macedonian",
            "MG":"Malagasy",
            "MS":"Malay",
            "ML":"Malayalam",
            "MT":"Maltese",
            "MI":"Maori",
            "MR":"Marathi",
            "MO":"Moldavian",
            "MN":"Mongolian",
            "NA":"Nauru",
            "NE":"Nepali",
            "NO":"Norwegian",
            "OC":"Occitan",
            "OR":"Oriya",
            "OM":"Oromo",
            "PS":"Pashto",
            "FA":"Persian",
            "PL":"Polish",
            "PT":"Portuguese",
            "PA":"Punjabi",
            "QU":"Quechua",
            "RM":"Rhaeto-Romance",
            "RO":"Romanian",
            "SM":"Samoan",
            "SG":"Sangro",
            "SA":"Sanskrit",
            "SR":"Serbian",
            "SH":"Serbo-Croatian",
            "ST":"Sesotho",
            "TN":"Setswana",
            "SN":"Shona",
            "SD":"Sindhi",
            "SI":"Singhalese",
            "SS":"Siswati",
            "SK":"Slovak",
            "SL":"Slovenian",
            "SO":"Somali",
            "SU":"Sudanese",
            "SW":"Swahili",
            "SV":"Swedish",
            "TG":"Tajik",
            "TA":"Tamil",
            "TT":"Tatar",
            "TE":"Tegulu",
            "TH":"Thai",
            "BO":"Tibetan",
            "TI":"Tigrinya",
            "TO":"Tonga",
            "TS":"Tsonga",
            "TR":"Turkish",
            "TK":"Turkmen",
            "TW":"Twi",
            "UK":"Ukrainian",
            "UR":"Urdu",
            "UZ":"Uzbek",
            "VO":"Volapuk",
            "CY":"Welsh",
            "WO":"Wolof",
            "XH":"Xhosa",
            "JI":"Yiddish",
            "YO":"Yoruba",
            "ZU":"Zulu"
        };
    </script>
</body>
</html>